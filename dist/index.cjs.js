"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react");var re={exports:{}},ee={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ae;function Ee(){if(ae)return ee;ae=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(s,o,a){var l=null;if(a!==void 0&&(l=""+a),o.key!==void 0&&(l=""+o.key),"key"in o){a={};for(var u in o)u!=="key"&&(a[u]=o[u])}else a=o;return o=a.ref,{$$typeof:t,type:s,key:l,ref:o!==void 0?o:null,props:a}}return ee.Fragment=e,ee.jsx=n,ee.jsxs=n,ee}var te={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce;function ke(){return ce||(ce=1,process.env.NODE_ENV!=="production"&&function(){function t(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===J?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case v:return"Fragment";case z:return"Profiler";case m:return"StrictMode";case y:return"Suspense";case T:return"SuspenseList";case V:return"Activity"}if(typeof r=="object")switch(typeof r.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),r.$$typeof){case p:return"Portal";case D:return(r.displayName||"Context")+".Provider";case S:return(r._context.displayName||"Context")+".Consumer";case I:var b=r.render;return r=r.displayName,r||(r=b.displayName||b.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case j:return b=r.displayName||null,b!==null?b:t(r.type)||"Memo";case M:b=r._payload,r=r._init;try{return t(r(b))}catch{}}return null}function e(r){return""+r}function n(r){try{e(r);var b=!1}catch{b=!0}if(b){b=console;var k=b.error,N=typeof Symbol=="function"&&Symbol.toStringTag&&r[Symbol.toStringTag]||r.constructor.name||"Object";return k.call(b,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",N),e(r)}}function s(r){if(r===v)return"<>";if(typeof r=="object"&&r!==null&&r.$$typeof===M)return"<...>";try{var b=t(r);return b?"<"+b+">":"<...>"}catch{return"<...>"}}function o(){var r=Z.A;return r===null?null:r.getOwner()}function a(){return Error("react-stack-top-frame")}function l(r){if(Q.call(r,"key")){var b=Object.getOwnPropertyDescriptor(r,"key").get;if(b&&b.isReactWarning)return!1}return r.key!==void 0}function u(r,b){function k(){E||(E=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",b))}k.isReactWarning=!0,Object.defineProperty(r,"key",{get:k,configurable:!0})}function i(){var r=t(this.type);return x[r]||(x[r]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),r=this.props.ref,r!==void 0?r:null}function f(r,b,k,N,B,F,X,H){return k=F.ref,r={$$typeof:g,type:r,key:b,props:F,_owner:B},(k!==void 0?k:null)!==null?Object.defineProperty(r,"ref",{enumerable:!1,get:i}):Object.defineProperty(r,"ref",{enumerable:!1,value:null}),r._store={},Object.defineProperty(r._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(r,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(r,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:X}),Object.defineProperty(r,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:H}),Object.freeze&&(Object.freeze(r.props),Object.freeze(r)),r}function _(r,b,k,N,B,F,X,H){var O=b.children;if(O!==void 0)if(N)if(d(O)){for(N=0;N<O.length;N++)$(O[N]);Object.freeze&&Object.freeze(O)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else $(O);if(Q.call(b,"key")){O=t(r);var P=Object.keys(b).filter(function(L){return L!=="key"});N=0<P.length?"{key: someKey, "+P.join(": ..., ")+": ...}":"{key: someKey}",K[O+N]||(P=0<P.length?"{"+P.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,N,O,P,O),K[O+N]=!0)}if(O=null,k!==void 0&&(n(k),O=""+k),l(b)&&(n(b.key),O=""+b.key),"key"in b){k={};for(var R in b)R!=="key"&&(k[R]=b[R])}else k=b;return O&&u(k,typeof r=="function"?r.displayName||r.name||"Unknown":r),f(r,O,F,B,o(),k,X,H)}function $(r){typeof r=="object"&&r!==null&&r.$$typeof===g&&r._store&&(r._store.validated=1)}var w=c,g=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),D=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),J=Symbol.for("react.client.reference"),Z=w.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=Object.prototype.hasOwnProperty,d=Array.isArray,C=console.createTask?console.createTask:function(){return null};w={"react-stack-bottom-frame":function(r){return r()}};var E,x={},A=w["react-stack-bottom-frame"].bind(w,a)(),U=C(s(a)),K={};te.Fragment=v,te.jsx=function(r,b,k,N,B){var F=1e4>Z.recentlyCreatedOwnerStacks++;return _(r,b,k,!1,N,B,F?Error("react-stack-top-frame"):A,F?C(s(r)):U)},te.jsxs=function(r,b,k,N,B){var F=1e4>Z.recentlyCreatedOwnerStacks++;return _(r,b,k,!0,N,B,F?Error("react-stack-top-frame"):A,F?C(s(r)):U)}}()),te}var le;function Re(){return le||(le=1,process.env.NODE_ENV==="production"?re.exports=Ee():re.exports=ke()),re.exports}var h=Re();const me={board:{className:"",columns:3,height:500,outlineStrokeColor:"#000",rows:4,scatterArea:0,showBoardSlotOutlines:!0,snapThreshold:20,width:400},checkLocalStorage:!0,completionAnimation:{type:"confetti",className:"",duration:3e3,message:"Puzzle Complete! ðŸŽ‰"},enableQRUnlock:!1,onComplete:()=>{},onPieceUnlock:()=>{},onRefresh:()=>{},puzzle:{className:"",responsive:!0,timer:{className:"",enabled:!0},refreshButton:{className:"",enabled:!0},rowsAndColumns:{className:"",enabled:!1}},puzzlePiece:{strokeColor:"gold",strokeEnabled:!0}},W={BOARD_CONFIG:"puzzle-geocache-board-config",PUZZLE_STATE:"puzzle-geocache-puzzle-state",TIMER_STATE:"puzzle-geocache-timer-state"},se=720*60*60*1e3,pe=2,he=c.createContext(void 0),_e=t=>{if(typeof window<"u"&&t){const e=localStorage.getItem(W.BOARD_CONFIG);if(e){const n=JSON.parse(e);if(typeof n.rows=="number"&&typeof n.columns=="number")return{rows:n.rows,columns:n.columns}}}return{}},$e=t=>{const{rows:e,columns:n}=_e(t.checkLocalStorage),[s,o]=c.useState(n??t.columns),[a,l]=c.useState(e??t.rows),[u,i]=c.useState(!0),[f,_]=c.useState(0),$=a*s,p={columns:s,numPieces:$,refreshCount:f,rows:a,timerIsRunning:u,setBoardGrid:(v,m)=>{l(v),o(m),i(!1),setTimeout(()=>i(!0),10)},refreshBoard:()=>{i(!1),_(v=>v+1),setTimeout(()=>i(!0),10)},setTimerIsRunning:i};return h.jsx(he.Provider,{value:p,children:t.children})},Te=()=>{const t=c.useContext(he);if(!t)throw new Error("usePuzzleContext must be used within a PuzzleProvider");return t},Ae=(t,e)=>e?{board:{className:e.board?.className??t.board.className,columns:e.board?.columns??t.board.columns,height:e.board?.height??t.board.height,outlineStrokeColor:e.board?.outlineStrokeColor??t.board.outlineStrokeColor,rows:e.board?.rows??t.board.rows,scatterArea:e.board?.scatterArea??t.board.scatterArea,showBoardSlotOutlines:e.board?.showBoardSlotOutlines??t.board.showBoardSlotOutlines,snapThreshold:e.board?.snapThreshold??t.board.snapThreshold,width:e.board?.width??t.board.width},checkLocalStorage:e.checkLocalStorage??t.checkLocalStorage,completionAnimation:{type:e.completionAnimation?.type??t.completionAnimation.type,className:e.completionAnimation?.className??t.completionAnimation.className,duration:e.completionAnimation?.duration??t.completionAnimation.duration,message:e.completionAnimation?.message??t.completionAnimation.message,customComponent:e.completionAnimation?.customComponent},enableQRUnlock:e.enableQRUnlock??t.enableQRUnlock,onComplete:e.onComplete??t.onComplete,onPieceUnlock:e.onPieceUnlock??t.onPieceUnlock,onRefresh:e.onRefresh??t.onRefresh,puzzlePiece:{strokeColor:e.puzzlePiece?.strokeColor??t.puzzlePiece.strokeColor,strokeEnabled:e.puzzlePiece?.strokeEnabled??t.puzzlePiece.strokeEnabled},puzzle:{className:e.puzzle?.className??t.puzzle.className,responsive:e.puzzle?.responsive??t.puzzle.responsive,timer:{className:e.puzzle?.timer?.className??t.puzzle.timer.className,enabled:e.puzzle?.timer?.enabled??t.puzzle.timer.enabled},refreshButton:{className:e.puzzle?.refreshButton?.className??t.puzzle.refreshButton.className,enabled:e.puzzle?.refreshButton?.enabled??t.puzzle.refreshButton.enabled},rowsAndColumns:{className:e.puzzle?.rowsAndColumns?.className??t.puzzle.rowsAndColumns.className,enabled:e.puzzle?.rowsAndColumns?.enabled??t.puzzle.rowsAndColumns.enabled}}}:t;function xe({initialX:t,initialY:e,initialIsSnapped:n=!1,boardRef:s,targetX:o,targetY:a,snapThreshold:l,onSnap:u,onPositionChange:i,onDragStart:f,onDragEnd:_}){const $=c.useRef(null),[w,g]=c.useState({isDragging:!1,x:t,y:e}),[p,v]=c.useState(n);c.useEffect(()=>{n!==void 0&&n!==p&&v(n)},[n,p]),c.useEffect(()=>{g(d=>d.isDragging||d.x===t&&d.y===e?d:{...d,x:t,y:e})},[t,e]);const m=c.useRef(null),z=c.useRef(null),S=c.useCallback((d,C)=>{const E=s.current;if(!E)return{x:d,y:C};const x=E.createSVGPoint();x.x=d,x.y=C;const A=x.matrixTransform(E.getScreenCTM()?.inverse());return{x:A.x,y:A.y}},[s]),D=c.useCallback((d,C)=>Math.hypot(d-o,C-a)<=l?(v(!0),g(x=>({...x,x:o,y:a,isDragging:!1})),u?.(),!0):!1,[o,a,l,u]),I=c.useCallback(d=>{const C=m.current;if(!C||!C.isDragging||d.pointerId!==C.pointerId)return;const E=S(d.clientX,d.clientY),x=E.x-C.offsetX,A=E.y-C.offsetY;g(U=>({...U,x,y:A})),d.preventDefault()},[S]);z.current=I;const y=c.useCallback(d=>{const C=m.current;if(!C||!C.isDragging||d.pointerId!==C.pointerId)return;C.isDragging=!1,z.current&&window.removeEventListener("pointermove",z.current),window.removeEventListener("pointerup",y),window.removeEventListener("pointercancel",y);const E=$.current;E&&E.hasPointerCapture(d.pointerId)&&E.releasePointerCapture(d.pointerId);const x=S(d.clientX,d.clientY),A=x.x-C.offsetX,U=x.y-C.offsetY;m.current=null,D(A,U)||(g(r=>({...r,isDragging:!1})),i&&i(A,U)),_(),d.preventDefault()},[S,D,_,i]),T=c.useCallback(d=>{if(p||!d.isPrimary)return;const C=$.current;if(!C)return;const E=S(d.clientX,d.clientY),x=E.x-w.x,A=E.y-w.y;m.current={offsetX:x,offsetY:A,pointerId:d.pointerId,isDragging:!0},C.setPointerCapture(d.pointerId),z.current&&window.addEventListener("pointermove",z.current,{passive:!1}),window.addEventListener("pointerup",y,{passive:!1}),window.addEventListener("pointercancel",y,{passive:!1}),g(U=>({...U,isDragging:!0})),f(),d.preventDefault()},[p,w.x,w.y,S,y,f]),j=c.useCallback(d=>{d.preventDefault()},[]),M=c.useCallback(d=>{d.preventDefault()},[]),V=c.useCallback(d=>{y(d.nativeEvent)},[y]),J=c.useCallback((d,C)=>{p||g(E=>({...E,x:d,y:C}))},[p]),Z=c.useCallback((d,C)=>{p||g(E=>{const x=E.x+d,A=E.y+C;return i&&setTimeout(()=>i(x,A),0),{...E,x,y:A}})},[p,i]),Q=c.useCallback(()=>p?!1:D(w.x,w.y),[p,w.x,w.y,D]);return{ref:$,dragState:w,isSnapped:p,moveTo:J,moveBy:Z,trySnap:Q,handlers:{onPointerDown:T,onPointerMove:j,onPointerUp:M,onPointerCancel:V,style:{touchAction:"none",cursor:p?"default":w.isDragging?"grabbing":"grab"}}}}const Ne="_puzzlePiece_i83y2_11",Ie="_unlockAnimation_i83y2_37",ie={puzzlePiece:Ne,unlockAnimation:Ie},Oe=10,je=({boardHeight:t,boardWidth:e,image:n,pieceIndex:s,initialX:o,initialY:a,initialIsSnapped:l,isNewlyUnlocked:u,path:i,snapThreshold:f,boardRef:_,targetX:$,targetY:w,puzzlePieceOptions:g,onSnap:p,onSnapWithKeyboard:v,onPositionChange:m,registerPieceRef:z,boardSlotKey:S,onDragStart:D,onDragEnd:I})=>{const{ref:y,dragState:T,isSnapped:j,moveBy:M,trySnap:V,handlers:J}=xe({initialX:o,initialY:a,initialIsSnapped:l,snapThreshold:f,boardRef:_,targetX:$,targetY:w,onSnap:p,onPositionChange:m,onDragStart:D,onDragEnd:I});c.useEffect(()=>(z&&z(S,y.current),()=>{z&&z(S,null)}),[y,z,S]);const Z=d=>{if(j)return;const C=Oe;switch(d.key){case"ArrowUp":d.preventDefault(),M(0,-C);break;case"ArrowDown":d.preventDefault(),M(0,C);break;case"ArrowLeft":d.preventDefault(),M(-C,0);break;case"ArrowRight":d.preventDefault(),M(C,0);break;case"Enter":case" ":{d.preventDefault(),V()&&v&&v();break}}};c.useEffect(()=>{T.isDragging&&y.current&&y.current.parentNode&&!j&&y.current.parentNode.appendChild(y.current)},[y,T.isDragging,j]),c.useEffect(()=>{if(!T.isDragging&&j&&y.current&&y.current.parentNode){const d=y.current.parentNode;d.firstChild!==y.current&&d.insertBefore(y.current,d.firstChild)}},[y,T.isDragging,j]);const Q=[ie.puzzlePiece,u?ie.unlockAnimation:""].filter(Boolean).join(" ");return h.jsxs("g",{ref:y,transform:j?"":`translate(${T.x},${T.y})`,...J,className:Q,tabIndex:j?-1:0,onKeyDown:Z,children:[h.jsx("defs",{children:h.jsx("clipPath",{id:`piece-clip-${s}`,children:h.jsx("path",{d:i})})}),h.jsx("image",{href:n,x:0,y:0,width:e,height:t,clipPath:`url(#piece-clip-${s})`,preserveAspectRatio:"xMidYMid slice"}),h.jsx("path",{d:i,fill:"none",stroke:j||!g.strokeEnabled?"":g.strokeColor,strokeWidth:g.strokeEnabled?pe:0})]})},De="_completionOverlay_1qv9y_1",Me="_message_1qv9y_14",Le="_confetti_1qv9y_41",Be="_confettiContainer_1qv9y_45",Ue="_confettiPiece_1qv9y_55",Fe="_fade_1qv9y_79",Ye="_zoom_1qv9y_102",G={completionOverlay:De,message:Me,confetti:Le,confettiContainer:Be,confettiPiece:Ue,fade:Fe,zoom:Ye},ge=({animationType:t,className:e="",duration:n=3e3,onAnimationComplete:s,message:o="Puzzle Complete! ðŸŽ‰"})=>{const[a,l]=c.useState(!0);if(c.useEffect(()=>{if(n>0){const i=setTimeout(()=>{l(!1),s?.()},n);return()=>clearTimeout(i)}},[n,s]),!a||t==="none")return null;const u={confetti:G.confetti,fade:G.fade,zoom:G.zoom,none:""}[t];return h.jsxs("div",{className:`${G.completionOverlay} ${u} ${e}`,children:[t==="confetti"&&h.jsx("div",{className:G.confettiContainer,children:Array.from({length:50}).map((i,f)=>h.jsx("div",{className:G.confettiPiece,style:{"--delay":`${Math.random()*.5}s`,"--x":`${Math.random()*100}vw`,"--rotation":`${Math.random()*360}deg`,"--color":["#ff0","#f0f","#0ff","#f00","#0f0","#00f"][Math.floor(Math.random()*6)]}},f))}),h.jsx("div",{className:G.message,children:o})]})},We=({columns:t,rows:e})=>{const n=[];for(let s=0;s<e;s++){n[s]=[];for(let o=0;o<t;o++){const a=o===t-1?0:(s+o)%2===0?1:-1,l=s===e-1?0:(s+o)%2===0?1:-1,u=o===0?0:-n[s][o-1][1],i=s===0?0:-n[s-1][o][2];n[s][o]=[i,a,l,u]}}return n},be=({col:t,row:e,options:n})=>{const{boardWidth:s,boardHeight:o,rows:a,columns:l,edgeMap:u}=n,i=s/l,f=o/a,_=t*i,$=e*f,[w,g,p,v]=u[e][t],m=Math.min(i,f)/3,z=m/2;let S=`M${_},${$}`;return w===0?S+=` h${i}`:(S+=` h${(i-m)/2}`,S+=` a${z},${z} 0 0 ${w===1?1:0} ${m},0`,S+=` h${(i-m)/2}`),g===0?S+=` v${f}`:(S+=` v${(f-m)/2}`,S+=` a${z},${z} 0 0 ${g===1?1:0} 0,${m}`,S+=` v${(f-m)/2}`),p===0?S+=` h-${i}`:(S+=` h-${(i-m)/2}`,S+=` a${z},${z} 0 0 ${p===1?1:0} -${m},0`,S+=` h-${(i-m)/2}`),v===0?S+=` v-${f}`:(S+=` v-${(f-m)/2}`,S+=` a${z},${z} 0 0 ${v===1?1:0} 0,-${m}`,S+=` v-${(f-m)/2}`),S+=" Z",S},Ze=()=>{const t=c.useCallback(l=>{try{const u=`${W.PUZZLE_STATE}-${l.imageId}`;localStorage.setItem(u,JSON.stringify(l))}catch(u){console.warn("Failed to save puzzle state:",u),Se();try{const i=`${W.PUZZLE_STATE}-${l.imageId}`;localStorage.setItem(i,JSON.stringify(l))}catch(i){console.error("Failed to save puzzle state after cleanup:",i)}}},[]),e=c.useCallback(l=>{try{const u=`${W.PUZZLE_STATE}-${l}`,i=localStorage.getItem(u);if(!i)return null;const f=JSON.parse(i);return!f.imageId||!Array.isArray(f.pieces)||!Array.isArray(f.snappedPieceIds)||typeof f.timestamp!="number"?(console.warn("Invalid puzzle state found, ignoring"),null):(f.unlockedPieceIds||(f.unlockedPieceIds=[]),f.imageId===l&&Date.now()-f.timestamp<se?f:(Date.now()-f.timestamp>=se&&localStorage.removeItem(u),null))}catch(u){return console.warn("Failed to load puzzle state:",u),null}},[]),n=c.useCallback(l=>{try{const u=`${W.PUZZLE_STATE}-${l}`;localStorage.removeItem(u)}catch(u){console.warn("Failed to clear puzzle state:",u)}},[]),s=c.useCallback((l,u)=>{try{const i=`${W.TIMER_STATE}-${l}`;localStorage.setItem(i,JSON.stringify(u))}catch(i){console.warn("Failed to save timer state:",i)}},[]),o=c.useCallback(l=>{try{const u=`${W.TIMER_STATE}-${l}`,i=localStorage.getItem(u);if(!i)return null;const f=JSON.parse(i);return typeof f.elapsedTime!="number"||typeof f.timestamp!="number"?null:Date.now()-f.timestamp<se?f:null}catch(u){return console.warn("Failed to load timer state:",u),null}},[]),a=c.useCallback(l=>{try{const u=`${W.TIMER_STATE}-${l}`;localStorage.removeItem(u)}catch(u){console.warn("Failed to clear timer state:",u)}},[]);return{savePuzzleState:t,loadPuzzleState:e,clearPuzzleState:n,saveTimerState:s,loadTimerState:o,clearTimerState:a}},Se=()=>{try{const t=Object.keys(localStorage),e=Date.now();t.forEach(n=>{if(n.startsWith(W.PUZZLE_STATE)||n.startsWith(W.TIMER_STATE))try{const s=localStorage.getItem(n);if(s){const o=JSON.parse(s);o.timestamp&&e-o.timestamp>=se&&localStorage.removeItem(n)}}catch{localStorage.removeItem(n)}})}catch(t){console.warn("Failed to cleanup old puzzles:",t)}},qe=(t,e,n,s)=>{const[o,a]=c.useState(new Set),[l,u]=c.useState(null),i=c.useRef(!1),f=c.useCallback(p=>{a(v=>{if(v.has(p))return v;const m=new Set([...v,p]);return u(p),setTimeout(()=>u(null),1e3),m})},[]);c.useEffect(()=>{if(!i.current){if(i.current=!0,!s){const p=new Set;for(let v=0;v<e;v++)for(let m=0;m<n;m++)p.add(`${v}-${m}`);a(p);return}try{const p=`${W.PUZZLE_STATE}-${t}`,v=localStorage.getItem(p);if(v){const m=JSON.parse(v);if(m.unlockedPieceIds&&Array.isArray(m.unlockedPieceIds)){a(new Set(m.unlockedPieceIds));return}}a(new Set)}catch(p){console.warn("Failed to load unlocked pieces:",p),a(new Set)}}},[t,s,e,n]),c.useEffect(()=>{if(!s)return;const v=new URLSearchParams(window.location.search).get("unlock");v&&(f(v),window.history.replaceState({},"",window.location.pathname))},[s,f]);const _=c.useCallback(p=>s?o.has(p):!0,[o,s]),$=c.useCallback(()=>l,[l]),w=c.useCallback(p=>{a(new Set(p))},[]),g=c.useCallback(()=>{a(new Set)},[]);return{unlockedPieceIds:Array.from(o),unlockPiece:f,isPieceUnlocked:_,getNewlyUnlockedPieceId:$,unlockAllPieces:w,resetUnlockedPieces:g,unlockedCount:o.size}},Qe=t=>{try{if(t.startsWith("data:")){const e=t.substring(0,Math.min(200,t.length));return btoa(e).substring(0,32).replace(/[/+=]/g,"_")}return btoa(t).substring(0,32).replace(/[/+=]/g,"_")}catch{let n=0;for(let s=0;s<t.length;s++){const o=t.charCodeAt(s);n=(n<<5)-n+o,n=n&n}return Math.abs(n).toString(36)}},Ve="_boardSlotOutline_mbtg0_1",Je="_snapped_mbtg0_6",ue={boardSlotOutline:Ve,snapped:Je},Ge=t=>{const{boardPathOptions:e,boardSlots:n,showBoardSlotOutlines:s,snappedPieceIds:o}=t;return s?h.jsx("g",{"data-testid":"board-outlines",children:n.map(({pieceRow:a,pieceCol:l})=>{const u=`${a}-${l}`,i=o.has(u);return h.jsx("path",{"data-testid":`outline-${a}-${l}`,className:`${ue.boardSlotOutline} ${i?ue.snapped:""}`,d:be({row:a,col:l,options:e}),stroke:e.outlineStrokeColor},`outline-${a}-${l}`)})}):null},Ke=(t,e)=>Array.from({length:t*e},(n,s)=>({pieceRow:Math.floor(s/e),pieceCol:s%e})),Xe=t=>{const e=[...t];for(let n=e.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[e[n],e[s]]=[e[s],e[n]]}return e},de=({boardWidth:t,boardHeight:e,boardSlots:n,pieceHeight:s,pieceWidth:o,scatterArea:a})=>{const l=Xe(n),u=t+a*2,i=e+a*2,f=-a,_=-a;return l.map(({pieceRow:$,pieceCol:w})=>{const g=f+Math.random()*(u-o),p=_+Math.random()*(i-s),v=w*o,m=$*s,z=g-v,S=p-m;return{pieceRow:$,pieceCol:w,x:z,y:S}})},He="_board_13b9q_1",et={board:He},tt=t=>{const{boardHeight:e,boardWidth:n,checkLocalStorage:s,className:o,columns:a,completionAnimation:l,enableQRUnlock:u,image:i,onPieceUnlock:f,onPuzzleComplete:_,outlineStrokeColor:$,puzzlePieceOptions:w,rows:g,showBoardSlotOutlines:p,snapThreshold:v,scatterArea:m,onAnyPieceActiveChange:z}=t,S=e/g,D=n/a,[I,y]=c.useState([]),[T,j]=c.useState(new Set),[M,V]=c.useState(!1),[J,Z]=c.useState(!1),Q=c.useRef(null),d=c.useRef(new Map),{savePuzzleState:C,loadPuzzleState:E,clearPuzzleState:x}=Ze(),A=c.useMemo(()=>Qe(i),[i]),{unlockedPieceIds:U,isPieceUnlocked:K,getNewlyUnlockedPieceId:r}=qe(A,g,a,u),b=c.useMemo(()=>We({rows:g,columns:a}),[g,a]),k=c.useMemo(()=>({boardHeight:e,boardWidth:n,columns:a,edgeMap:b,outlineStrokeColor:$,rows:g}),[e,n,a,b,$,g]),N=c.useMemo(()=>Ke(g,a),[g,a]);c.useEffect(()=>{s&&Se()},[s]),c.useEffect(()=>{let P=null;if(s&&(P=E(A)),P&&P.rows===g&&P.columns===a&&P.pieces.length===g*a)y(P.pieces),j(new Set(P.snappedPieceIds)),V(!0);else{const R=de({boardHeight:e,boardWidth:n,boardSlots:N,pieceHeight:S,pieceWidth:D,scatterArea:m});y(R),j(new Set),V(!0)}d.current.clear()},[A,g,a,s]);const B=c.useRef({boardHeight:e,boardWidth:n,scatterArea:m});c.useEffect(()=>{if(!M)return;if(B.current.boardHeight!==e||B.current.boardWidth!==n||B.current.scatterArea!==m){B.current={boardHeight:e,boardWidth:n,scatterArea:m};const R=de({boardHeight:e,boardWidth:n,boardSlots:N,pieceHeight:S,pieceWidth:D,scatterArea:m});y(R),j(new Set),d.current.clear()}},[e,n,m,M]),c.useEffect(()=>{if(!s||!M||I.length===0)return;const P=setTimeout(()=>{C({imageId:A,pieces:I,snappedPieceIds:Array.from(T),unlockedPieceIds:U,timestamp:Date.now(),rows:g,columns:a})},500);return()=>clearTimeout(P)},[I,T,U,A,g,a,s,M,C]),c.useEffect(()=>{const P=g*a;T.size===P&&T.size>0&&(Z(!0),s&&x(A),_?.())},[T.size,g,a,_,x,A,s]);const F=c.useCallback((P,R,L)=>{y(q=>{const Y=[...q];return Y[P]={...Y[P],x:R,y:L},Y})},[]),X=P=>{const{pieceRow:R,pieceCol:L}=I[P],q=`${R}-${L}`;j(Y=>new Set([...Y,q]))},H=P=>{const R=I.find((L,q)=>{const Y=`${L.pieceRow}-${L.pieceCol}`;return q!==P&&!T.has(Y)});if(R){const L=`${R.pieceRow}-${R.pieceCol}`,q=d.current.get(L);q&&q.focus()}},O=(P,R)=>{R?d.current.set(P,R):d.current.delete(P)};return h.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[h.jsxs("svg",{ref:Q,className:`${et.board} ${o}`,"data-testid":"board",height:e,width:n,viewBox:`0 0 ${n} ${e}`,children:[h.jsx(Ge,{boardPathOptions:k,boardSlots:N,showBoardSlotOutlines:p,snappedPieceIds:T}),I.map((P,R)=>({...P,originalIndex:R})).filter(({pieceRow:P,pieceCol:R})=>{const L=`${P}-${R}`;return u?K(L):!0}).map(({pieceRow:P,pieceCol:R,x:L,y:q,originalIndex:Y},St)=>{const oe=`${P}-${R}`,we=T.has(oe),Pe=r()===oe;return h.jsx(je,{boardHeight:e,boardWidth:n,boardSlotKey:oe,image:i,pieceIndex:Y,initialX:L,initialY:q,initialIsSnapped:we,isNewlyUnlocked:Pe,onSnap:()=>X(Y),onSnapWithKeyboard:()=>H(Y),onPositionChange:(Ce,ye)=>F(Y,Ce,ye),path:be({col:R,row:P,options:k}),puzzlePieceOptions:w,registerPieceRef:O,snapThreshold:v,boardRef:Q,targetX:R*D/100,targetY:P*S/100,onDragStart:()=>z?.(!0),onDragEnd:()=>z?.(!1)},oe)})]}),J&&l.customComponent?h.jsx(l.customComponent,{}):J&&l.type!=="none"?h.jsx(ge,{animationType:l.type,className:l.className,duration:l.duration,message:l.message,onAnimationComplete:l.duration>0?()=>Z(!1):void 0}):null]})},nt="_editRowsColumns_1gi2i_1",ot="_inlineNote_1gi2i_51",fe={editRowsColumns:nt,inlineNote:ot},rt=t=>{const{className:e,currentColumns:n,currentRows:s,onBoardSlotChange:o}=t,[a,l]=c.useState(s.toString()),[u,i]=c.useState(n.toString()),f=parseInt(a)!==s||parseInt(u)!==n,_=parseInt(a)>=2&&parseInt(a)<=10,$=parseInt(u)>=2&&parseInt(u)<=10,w=_&&$&&f;c.useEffect(()=>{l(s.toString()),i(n.toString())},[s,n]);const g=m=>{const z=m.target.value;(z===""||/^\d+$/.test(z))&&l(z)},p=m=>{const z=m.target.value;(z===""||/^\d+$/.test(z))&&i(z)},v=m=>{m.preventDefault(),w&&(localStorage.setItem("puzzle-geocache",JSON.stringify({rows:parseFloat(a),columns:parseFloat(u)})),o(parseInt(a),parseInt(u)))};return h.jsxs(h.Fragment,{children:[h.jsxs("form",{"data-testid":"edit-rows-columns",className:`${fe.editRowsColumns} ${e}`,onSubmit:v,children:[h.jsxs("label",{children:["Rows:",h.jsx("input",{type:"text",value:a,onChange:g,placeholder:"2-10"})]}),h.jsxs("label",{children:["Cols:",h.jsx("input",{type:"text",value:u,onChange:p,placeholder:"2-10"})]}),h.jsx("input",{type:"submit",value:"Ok",disabled:!w})]}),h.jsx("span",{className:fe.inlineNote,children:"(Valid numbers: 2-10)"})]})},st="_refreshButton_17b0p_1",at={refreshButton:st},ct=t=>{const{className:e,onRefresh:n}=t;return h.jsx("button",{"data-testid":"refresh-button",className:`${at.refreshButton} ${e}`,onClick:n,title:"Refresh puzzle",children:h.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#000000",strokeWidth:pe,strokeLinecap:"round",strokeLinejoin:"round",children:[h.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),h.jsx("path",{d:"M21 3v5h-5"}),h.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),h.jsx("path",{d:"M3 21v-5h5"})]})})},lt="_timer_1vcjo_1",it={timer:lt},ut=t=>{const{className:e,isRunning:n,onTimeUpdate:s}=t,[o,a]=c.useState(0),l=c.useRef(null);c.useEffect(()=>(n?l.current=setInterval(()=>{a(i=>{const f=i+1;return s?.(f),f})},1e3):l.current&&(clearInterval(l.current),l.current=null),()=>{l.current&&clearInterval(l.current)}),[n,s]),c.useEffect(()=>{n&&a(0)},[n]);const u=i=>{const f=Math.floor(i/60),_=i%60;return`${f.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`};return h.jsx("div",{"data-testid":"timer",className:`${it.timer} ${e}`,children:u(o)})},dt="_puzzle_c9hl6_1",ft="_responsive_c9hl6_5",mt="_settingsContainer_c9hl6_13",ne={puzzle:dt,responsive:ft,settingsContainer:mt},pt=t=>{const{image:e,onComplete:n,onRefresh:s,options:o}=t,{columns:a,refreshBoard:l,refreshCount:u,rows:i,setBoardGrid:f,setTimerIsRunning:_,timerIsRunning:$}=Te(),[w,g]=c.useState(!1);c.useEffect(()=>{if(!w)return;const I=T=>{T.preventDefault()},y=T=>{T.preventDefault()};return window.addEventListener("touchmove",I,{passive:!1}),window.addEventListener("gesturestart",y,{passive:!1}),()=>{window.removeEventListener("touchmove",I),window.removeEventListener("gesturestart",y)}},[w]);const p=(I,y)=>{f(I,y)},v=()=>{s?.(),l()},m=()=>{_(!1),n?.()},z=o.board.width/o.board.height,S=o.puzzle.responsive?`${ne.puzzle} ${ne.responsive}`:ne.puzzle,D=c.useMemo(()=>({...o.puzzle.responsive?{"--puzzle-aspect-ratio":z.toString()}:{},touchAction:w?"none":void 0,overscrollBehavior:w?"none":void 0}),[o.puzzle.responsive,z,w]);return h.jsxs("div",{"data-testid":"puzzle-content",className:S,style:D,children:[o.puzzle.timer.enabled||o.puzzle.refreshButton.enabled?h.jsxs("div",{className:ne.settingsContainer,children:[o.puzzle.timer.enabled&&h.jsx(ut,{className:o.puzzle.timer.className,isRunning:$}),o.puzzle.refreshButton.enabled&&h.jsx(ct,{className:o.puzzle.refreshButton.className,onRefresh:v})]}):null,h.jsx(tt,{boardHeight:o.board.height,boardWidth:o.board.width,checkLocalStorage:o.checkLocalStorage,className:o.board.className,columns:a,completionAnimation:o.completionAnimation,enableQRUnlock:o.enableQRUnlock,image:e,onPieceUnlock:o.onPieceUnlock,onPuzzleComplete:m,outlineStrokeColor:o.board.outlineStrokeColor,puzzlePieceOptions:o.puzzlePiece,rows:i,scatterArea:o.board.scatterArea,showBoardSlotOutlines:o.board.showBoardSlotOutlines,snapThreshold:o.board.snapThreshold,onAnyPieceActiveChange:g},`${i}-${a}-${u}`),o.puzzle.rowsAndColumns.enabled&&h.jsx("div",{className:ne.settingsContainer,children:h.jsx(rt,{className:o.puzzle.rowsAndColumns.className,currentRows:i,currentColumns:a,onBoardSlotChange:p})})]})},ht=t=>{const{options:e}=t,n=Ae(me,e);return h.jsx($e,{checkLocalStorage:n.checkLocalStorage,columns:n.board.columns,rows:n.board.rows,children:h.jsx(pt,{...t,options:n})})},ve=(t,e,n)=>{const s=[];let o=1;for(let a=0;a<e;a++)for(let l=0;l<n;l++){const u=`${a}-${l}`,i=`${t}?unlock=${u}`;s.push({pieceId:u,row:a,col:l,url:i,displayName:`Piece ${o}`}),o++}return s},gt=(t,e,n)=>{const s=`${e}-${n}`;return`${t}?unlock=${s}`},ze=t=>{const e=["Piece ID","Display Name","Row","Column","QR Code URL"],n=t.map(o=>[o.pieceId,o.displayName,o.row.toString(),o.col.toString(),o.url]);return[e,...n].map(o=>o.join(",")).join(`
`)},bt=()=>{const s=ve("https://yoursite.com/puzzle",4,3);console.log("=== QR Code URLs for Printing ==="),console.log(`Generate QR codes from these URLs and print them on cards:
`),s.forEach(o=>{console.log(`${o.displayName} (${o.pieceId}):`),console.log(`  URL: ${o.url}`),console.log("")}),console.log(`
=== CSV Export ===`),console.log("Copy this CSV data and paste into a spreadsheet:"),console.log(ze(s))};exports.CompletionAnimation=ge;exports.DEFAULT_PUZZLE_OPTIONS=me;exports.Puzzle=ht;exports.exportQRCodesAsCSV=ze;exports.generatePuzzleQRCodes=ve;exports.generateSinglePieceQRCode=gt;exports.printQRCodeExample=bt;
